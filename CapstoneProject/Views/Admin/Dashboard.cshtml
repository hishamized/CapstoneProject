@model CapstoneProject.Models.Admin

@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="bg-gray-900 text-gray-100 min-h-screen flex" x-data="{ sidebarOpen: false, currentPage: 'dashboard' }">

    <!-- Sidebar -->
    <aside x-show="sidebarOpen"
           @@click.away ="sidebarOpen = false"
           x-transition:enter="transition transform duration-300"
           x-transition:enter-start="-translate-x-full"
           x-transition:enter-end="translate-x-0"
           x-transition:leave="transition transform duration-300"
           x-transition:leave-start="translate-x-0"
           x-transition:leave-end="-translate-x-full"
           class="fixed md:relative z-30 w-64 bg-gray-800 border-r border-gray-700 h-screen p-6">

        <h2 class="text-2xl font-bold text-red-500 mb-8">Admin Panel</h2>
        <ul class="space-y-2">
            <li><button x-on:click="currentPage = 'dashboard'" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700">Dashboard</button></li>
            <li><button x-on:click="currentPage = 'admins'" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700">Admins</button></li>
            <li><button x-on:click="currentPage = 'roles'" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700">Roles</button></li>
            <li><button x-on:click="currentPage = 'settings'" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700">Settings</button></li>
            <li><button x-on:click="currentPage = 'AddAdmin'" class="bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-2 rounded-lg shadow-md transition">+ Add Admin</button></li>
            <li><button x-on:click="currentPage = 'AddCategory'" class="bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-2 rounded-lg shadow-md transition">+ Add Category</button></li>
            <li><button x-on:click="currentPage = 'AddProduct'" class="bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-2 rounded-lg shadow-md transition">+ Add Product</button></li>
            <li>
                <a href="@Url.Action("ManageCategories", "Admin")" class="w-full block px-3 py-2 rounded hover:bg-gray-700 text-left">Manage Categories</a>
            </li>
            <li>
                <a href="@Url.Action("ManageProducts", "Admin")" class="w-full block px-3 py-2 rounded hover:bg-gray-700 text-left">Manage Products</a>
            </li>
        </ul>
    </aside>

    <!-- Main content -->
    <div class="flex-1 flex flex-col md:ml-64 transition-all duration-300">

        <!-- Top navbar -->
        <nav class="flex items-center justify-between bg-gray-800 border-b border-gray-700 px-6 py-4">
            <button x-on:click="sidebarOpen = !sidebarOpen"
                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>


            <!-- Admin Info -->
            <div class="flex items-center space-x-4">
                <div>
                    <p class="font-semibold">@TempData["AdminName"]</p>
                    <p class="text-sm text-gray-400">@TempData["AdminUsername"]</p>
                    <p class="text-sm text-gray-400">@TempData["AdminEmail"]</p>
                </div>
            </div>

            <!-- Messages -->
            <div class="mb-4">
                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="bg-green-500 text-white px-4 py-2 rounded shadow">
                        @TempData["SuccessMessage"]
                    </div>
                }
                else if (TempData["ErrorMessage"] != null)
                {
                    <div class="bg-red-500 text-white px-4 py-2 rounded shadow">
                        @TempData["ErrorMessage"]
                    </div>
                }
            </div>

            <!-- Logout -->
            <a href="/Admin/Logout" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-white">Logout</a>
        </nav>

        <!-- Dynamic content -->
        <main class="p-6 flex-1 overflow-y-auto">

            <!-- Dashboard -->
            <div x-show="currentPage === 'dashboard'" x-cloak>
                <h1 class="text-3xl font-bold mb-6 text-red-500">Dashboard</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-gray-800 p-6 rounded shadow hover:shadow-lg transition duration-200">
                        <h2 class="text-xl font-semibold mb-2">Total Admins</h2>
                        <p class="text-gray-300 text-2xl">5</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded shadow hover:shadow-lg transition duration-200">
                        <h2 class="text-xl font-semibold mb-2">Total Roles</h2>
                        <p class="text-gray-300 text-2xl">5</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded shadow hover:shadow-lg transition duration-200">
                        <h2 class="text-xl font-semibold mb-2">Pending Tasks</h2>
                        <p class="text-gray-300 text-2xl">12</p>
                    </div>
                </div>
            </div>

            <!-- Admins -->
            <div x-show="currentPage === 'admins'" x-cloak>
                @await Html.PartialAsync("Partials/Admin/_AdminList", (IEnumerable<CapstoneProject.Models.Admin>)ViewBag.Admins)
            </div>

            <!-- Roles -->
            <div x-show="currentPage === 'roles'" x-cloak>
                <h1 class="text-3xl font-bold mb-6 text-red-500">Roles</h1>
                <p class="text-gray-400">Role management section.</p>
            </div>

            <!-- Settings -->
            <div x-show="currentPage === 'settings'" x-cloak>
                <h1 class="text-3xl font-bold mb-6 text-red-500">Settings</h1>
                <p class="text-gray-400">Application settings go here.</p>
            </div>

            <!-- Add Admin Form -->
            @await Html.PartialAsync("Partials/Admin/_AddAdminForm", Model)

            <!-- Add Category Form -->
            @await Html.PartialAsync("Partials/Admin/_AddCategoryForm")

            <!-- Add Product Form -->
            @await Html.PartialAsync("Partials/Admin/_AddProductForm", new CapstoneProject.Models.Product())

        </main>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function() {
            // Validate AddCategory image file type
            $('form[action="/Admin/AddCategory"]').on('submit', function(e) {
                var fileInput = $(this).find('input[name="imageFile"]')[0];
                var filePath = fileInput.value;

                if (filePath) {
                    var allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif|\.webp)$/i;
                    if (!allowedExtensions.exec(filePath)) {
                        e.preventDefault();
                        alert('Invalid file type. Only .jpg, .jpeg, .png, .gif, .webp files are allowed.');
                        fileInput.value = '';
                        return false;
                    }
                }
            });
        });
    </script>
}
